# Activar rewrite engine
RewriteEngine On

# --- Forzar HTTPS y sin www (funciona con o sin Cloudflare) ---
RewriteCond %{HTTPS} !=on [OR]
RewriteCond %{HTTP:X-Forwarded-Proto} !https
RewriteCond %{HTTP_HOST} ^www\.(.+)$ [NC]
RewriteRule ^ https://%1%{REQUEST_URI} [R=301,L]

# --- Quitar extensiones (.php y .html) ---
# Servir archivos sin mostrar extensión
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME}\.php -f
RewriteRule ^(.+?)/?$ $1.php [L]

RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME}\.html -f
RewriteRule ^(.+?)/?$ $1.html [L]

# Redirigir a versión sin extensión si entran con ella
RewriteCond %{THE_REQUEST} \s/+(.*)\.(php|html)[?\s] [NC]
RewriteRule ^ %1 [R=301,L]

# --- Compresión GZIP ---
<IfModule mod_deflate.c>
  AddOutputFilterByType DEFLATE text/plain text/html text/xml text/css
  AddOutputFilterByType DEFLATE text/javascript application/javascript application/x-javascript
  AddOutputFilterByType DEFLATE application/json application/xml
  AddOutputFilterByType DEFLATE font/ttf font/otf image/svg+xml
</IfModule>

# --- Cache-Control 1 año ---
<IfModule mod_headers.c>
  <FilesMatch "\.(ico|jpe?g|png|gif|webp|svg|css|js|woff2?|ttf|otf)$">
    Header set Cache-Control "max-age=31536000, public"
  </FilesMatch>
</IfModule>
